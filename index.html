<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeskFit - Your Micro-Habit Tracker</title>

    <!-- 
      ==================================================================
      == ESSENTIAL FARCASTER META TAGS                                ==
      == These MUST be in the raw HTML file served by your host.      ==
      ==================================================================
    -->
    <meta property="fc:frame" content="vNext" />
    <meta property="fc:frame:image" content="https://i.imgur.com/uR3JATB.png" /> 
    <meta property="og:image" content="https://i.imgur.com/uR3JATB.png" />
    <meta property="fc:frame:button:1" content="Start Your Micro-Habits" />
    <meta property="og:title" content="DeskFit - Your Micro-Habit Tracker" />

    <!-- Farcaster JS SDK -->
    <script src="https://farcaster.dev/js/index.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background: linear-gradient(to bottom right, #e0f2f7, #c1e4f4); color: #333; text-align: center; }
        .app-container { background-color: #ffffff; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); padding: 40px; max-width: 400px; width: 90%; display: flex; flex-direction: column; gap: 20px; }
        h1 { color: #2c3e50; margin-bottom: 5px; font-size: 2.2em; }
        p.tagline { color: #7f8c8d; font-size: 1.1em; margin-top: 0; margin-bottom: 20px; }
        .task-display { background-color: #f8f8f8; border: 1px solid #dcdcdc; border-radius: 10px; padding: 25px 20px; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 1.4em; font-weight: 600; color: #34495e; transition: background-color 0.3s ease, transform 0.3s ease; }
        .task-display.new-task { animation: fadeInScale 0.5s ease-out; }
        .task-text { margin-bottom: 10px; }
        .xp-text { font-size: 0.9em; color: #27ae60; font-weight: 700; display: flex; align-items: center; gap: 5px; }
        .xp-text::before { content: '‚ú®'; font-size: 1.2em; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .buttons-container { display: flex; gap: 15px; width: 100%; justify-content: center; }
        button { background-color: #3498db; color: white; border: none; border-radius: 8px; padding: 15px 25px; font-size: 1.2em; cursor: pointer; transition: background-color 0.3s ease, transform 0.1s ease; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4); flex: 1; min-width: 120px; }
        button.complete { background-color: #2ecc71; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4); }
        button.complete:hover { background-color: #27ae60; }
        button.skip { background-color: #e74c3c; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4); }
        button.skip:hover { background-color: #c0392b; }
        button:hover { transform: translateY(-2px); }
        button:active { transform: translateY(0); box-shadow: 0 2px 10px rgba(52, 152, 219, 0.4); }
        .stats-container { display: flex; justify-content: space-around; margin-top: 10px; }
        .total-xp-display, .streak-display { font-size: 1.1em; font-weight: 600; color: #2c3e50; display: flex; align-items: center; gap: 8px; }
        .total-xp-display::before { content: '‚≠ê'; font-size: 1.3em; }
        .streak-display::before { content: 'üî•'; font-size: 1.3em; }
        .share-button { margin-top: 15px; background-color: #8e44ad; font-size: 1em; padding: 10px 20px; box-shadow: 0 4px 15px rgba(142, 68, 173, 0.4); display: none; }
        .share-button:hover { background-color: #732d91; }
    </style>
</head>
<body>
    <div class="app-container">
        <h1>DeskFit</h1>
        <p class="tagline">Fitness for your desk life. Small moves, mindful days.</p>
        <div id="taskDisplay" class="task-display">
            <div class="task-text">Click "Get Task" to start your journey!</div>
            <div class="xp-text" id="currentTaskXP"></div>
        </div>
        <div class="buttons-container">
            <button id="completeTaskButton" class="complete" style="display:none;">Complete Task</button>
            <button id="skipTaskButton" class="skip" style="display:none;">Skip Task</button>
            <button id="getNewTaskButton">Get Task</button>
        </div>
        <div class="stats-container">
            <div id="totalXPDisplay" class="total-xp-display"><span id="xpValue">0</span> XP</div>
            <div id="streakDisplay" class="streak-display"><span id="streakValue">0</span> Streak</div>
        </div>
        <button id="shareProgressButton" class="share-button">Share Progress</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DOM ELEMENTS ---
            const getNewTaskButton = document.getElementById('getNewTaskButton');
            const completeTaskButton = document.getElementById('completeTaskButton');
            const skipTaskButton = document.getElementById('skipTaskButton');
            const shareProgressButton = document.getElementById('shareProgressButton');
            const taskDisplay = document.getElementById('taskDisplay');
            const taskTextElement = taskDisplay.querySelector('.task-text');
            const currentTaskXPElement = document.getElementById('currentTaskXP');
            const totalXPDisplay = document.getElementById('xpValue');
            const streakDisplay = document.getElementById('streakValue');

            // --- APP STATE ---
            let totalXP = 0;
            let streak = 0;
            let currentTask = null;
            let farcasterUserFid = null;

            const tasks = [ { text: "Stand for 10 minutes", xp: 15 }, { text: "Take 3 floors with stairs", xp: 20 }, { text: "Skip snacks for today", xp: 25 }, { text: "Drink a glass of water", xp: 10 }, { text: "Stretch your arms overhead", xp: 10 }, { text: "Roll your shoulders backward 10 times", xp: 10 }, { text: "Walk one lap around the room", xp: 15 }, { text: "Walk while on a call", xp: 15 }, { text: "Do 10 squats", xp: 20 }, { text: "Touch your toes 10 times", xp: 15 }, { text: "Refill your water bottle", xp: 10 }, { text: "Do calf raises for 30 seconds", xp: 15 }, { text: "Walk to a colleague instead of messaging", xp: 20 }, { text: "Stand during your next meeting", xp: 15 }, { text: "March in place for 1 minute", xp: 15 }, { text: "Do a 2 minute stretch break", xp: 10 }, { text: "Take a short walk after lunch", xp: 20 }, { text: "Stand on one leg for 20 seconds per side", xp: 15 }, { text: "Do a wall sit for 30 seconds", xp: 20 }, { text: "Straighten your posture for 1 minute", xp: 10 }, { text: "Stretch your wrists and fingers", xp: 10 }, { text: "Rotate your neck gently", xp: 10 }, { text: "Do 15 chair squats", xp: 15 }, { text: "Take the long route to the restroom", xp: 15 }, { text: "Do 10 push ups against the wall", xp: 20 }, { text: "Balance on one foot for 30 seconds", xp: 15 }, { text: "Walk outside for 5 minutes", xp: 25 }, { text: "Do ankle circles", xp: 10 }, { text: "Sit upright for the next 30 minutes", xp: 10 }, { text: "Do a 15 second plank", xp: 20 }, { text: "Stretch your back gently", xp: 10 }, { text: "Do 10 lunges", xp: 20 }, { text: "Walk to refill water on another floor", xp: 20 }, { text: "Walk 100 steps after eating", xp: 15 }, { text: "Stand while reading emails", xp: 10 }, { text: "Refill your bottle twice before lunch", xp: 15 }, { text: "Drink a glass of water before coffee", xp: 10 }, { text: "Take 3 sips of water every 15 minutes", xp: 15 }, { text: "Track total glasses of water today", xp: 20 }, { text: "Drink one cup of water per hour", xp: 15 }, { text: "Skip sugary drinks today", xp: 25 }, { text: "Have fruit instead of a snack", xp: 20 }, { text: "Eat lunch away from your desk", xp: 20 }, { text: "Chew slowly and mindfully", xp: 15 }, { text: "Have a smaller lunch portion", xp: 15 }, { text: "Avoid vending machine snacks", xp: 25 }, { text: "Prepare your own lunch", xp: 20 }, { text: "Eat one green item today", xp: 15 }, { text: "Replace dessert with herbal tea", xp: 20 }, { text: "Drink a glass of water before lunch", xp: 10 }, { text: "Skip coffee this afternoon", xp: 20 }, { text: "Replace soda with water", xp: 25 }, { text: "Track calories for one meal", xp: 20 }, { text: "Take stairs instead of elevator", xp: 20 }, { text: "Walk while brainstorming", xp: 15 }, { text: "Step away from desk for 5 minutes", xp: 15 }, { text: "Look out the window for 30 seconds", xp: 10 }, { text: "Do 10 deep breaths", xp: 10 }, { text: "Blink slowly 10 times", xp: 10 }, { text: "Stretch your chest open", xp: 10 }, { text: "Move your eyes off the screen for 20 seconds", xp: 10 }, { text: "Adjust your chair posture", xp: 10 }, { text: "Stand up every 45 minutes", xp: 15 }, { text: "Take a deep squat for 15 seconds", xp: 15 }, { text: "Do arm circles for 20 seconds", xp: 10 }, { text: "Walk the perimeter of your floor", xp: 20 }, { text: "Do 10 triceps dips on chair edge", xp: 15 }, { text: "Walk to talk to someone instead of texting", xp: 15 }, { text: "Use restroom on another floor", xp: 15 }, { text: "Stretch hamstrings at your desk", xp: 10 }, { text: "Sit cross legged for 5 minutes", xp: 15 }, { text: "Take a 5 minute walk outside", xp: 25 }, { text: "Straighten your spine while sitting", xp: 10 }, { text: "Relax your shoulders consciously", xp: 10 }, { text: "Do 10 jumping jacks", xp: 20 }, { text: "Hold a plank for 20 seconds", xp: 20 }, { text: "Walk around before your next call", xp: 15 }, { text: "Stretch your calves against the wall", xp: 10 }, { text: "Do side bends 10 times", xp: 15 }, { text: "Do torso twists for 1 minute", xp: 15 }, { text: "Do seated leg lifts", xp: 10 }, { text: "Lift both arms and reach high", xp: 10 }, { text: "Walk 200 steps before lunch", xp: 15 }, { text: "Stand up between every email", xp: 10 }, { text: "Walk for 2 minutes before break", xp: 15 }, { text: "Close your eyes for 30 seconds", xp: 10 }, { text: "Smile for 30 seconds", xp: 10 }, { text: "Compliment a colleague", xp: 10 }, { text: "Take a screen free break", xp: 15 }, { text: "Do slow breathing: 4 in, 6 out, repeat 5x", xp: 15 }, { text: "Step outside and get sunlight", xp: 20 }, { text: "Clean your desk surface", xp: 10 }, { text: "Organize one drawer", xp: 10 }, { text: "Write down three things you‚Äôre grateful for", xp: 15 }, { text: "Do gentle neck stretches", xp: 10 }, { text: "Move your legs under the desk", xp: 10 }, { text: "Stand when reading a document", xp: 10 }, { text: "Walk while listening to music", xp: 15 }, { text: "Stand for your next meeting", xp: 15 }, { text: "Take the stairs twice today", xp: 20 }, { text: "Walk 500 steps before 10 a.m.", xp: 25 }, { text: "Walk 500 steps after 3 p.m.", xp: 25 }, { text: "Do a micro stretch after every call", xp: 10 }, { text: "Take 5 deep breaths before replying to emails", xp: 15 }, { text: "Do 10 wall pushups", xp: 15 }, { text: "Stand when brainstorming ideas", xp: 10 }, { text: "Look far into the distance to rest eyes", xp: 10 }, { text: "Straighten your wrists and fingers", xp: 10 }, { text: "Stand while drinking water", xp: 10 }, { text: "Do 10 side lunges", xp: 20 }, { text: "Do hip rotations for 30 seconds", xp: 15 }, { text: "Do calf raises while waiting", xp: 10 }, { text: "Refill your bottle after every meeting", xp: 15 }, { text: "Move your printer farther away", xp: 15 }, { text: "Take 100 steps after lunch", xp: 15 }, { text: "Replace snack with water", xp: 20 }, { text: "Eat slowly at lunch", xp: 15 }, { text: "Avoid second servings", xp: 20 }, { text: "Don‚Äôt eat at your desk today", xp: 20 }, { text: "Plan your lunch tomorrow", xp: 15 }, { text: "Drink only water between meals", xp: 20 }, { text: "Avoid sugar today", xp: 25 }, { text: "Stretch before lunch", xp: 10 }, { text: "Take a 10 minute walk after work", xp: 25 }, { text: "Move around while talking on the phone", xp: 15 }, { text: "Do posture check every hour", xp: 10 }, { text: "Take a walk before checking social media", xp: 15 }, { text: "Stretch your hands every hour", xp: 10 }, { text: "Keep your shoulders back", xp: 10 }, { text: "Take a micro nap (2‚Äì5 min rest)", xp: 15 }, { text: "Read something inspiring", xp: 10 }, { text: "Stand in sunlight for 1 minute", xp: 15 }, { text: "Stretch chest and back for 30 seconds", xp: 10 }, { text: "Adjust your monitor height", xp: 10 }, { text: "Keep feet flat for posture", xp: 10 }, { text: "Do 10 second breathing reset", xp: 10 }, { text: "Drink water before leaving desk", xp: 10 }, { text: "Walk before your coffee break", xp: 15 }, { text: "Avoid screens for 3 minutes", xp: 15 }, { text: "Take stairs one extra time today", xp: 15 }, { text: "Walk to refill your bottle three times", xp: 20 }, { text: "Stretch your neck while waiting", xp: 10 }, { text: "Stand while reading notes", xp: 10 }, { text: "Stand while waiting for downloads", xp: 10 }, { text: "Do 15 chair squats", xp: 15 }, { text: "Take a few slow, deep breaths", xp: 10 }, { text: "Lift knees while sitting", xp: 10 }, { text: "Walk across office once per hour", xp: 15 }, { text: "Drink a glass of water right now", xp: 10 }, { text: "Stand after finishing each task", xp: 10 }, { text: "Stretch calves while brushing teeth", xp: 10 }, { text: "Balance on one leg while thinking", xp: 15 }, { text: "Laugh intentionally", xp: 10 }, { text: "Smile at someone walking by", xp: 10 }, { text: "Listen to calm music", xp: 10 }, { text: "Walk outdoors if possible", xp: 20 }, { text: "Do one minute of mindfulness", xp: 15 }, { text: "Take one long breath before replying to messages", xp: 10 }, { text: "Sit tall and straighten your spine", xp: 10 }, { text: "Walk in place while reading", xp: 10 }, { text: "Take a few mindful steps", xp: 10 }, { text: "Stretch both sides equally", xp: 10 }, { text: "Raise both arms like a ‚ÄúY‚Äù", xp: 10 }, { text: "Stand for 5 minutes every hour", xp: 15 }, { text: "Drink water before your next task", xp: 10 }, { text: "Walk before your break", xp: 15 }, { text: "Look away from your screen for 20 seconds", xp: 10 }, { text: "Straighten your posture now", xp: 10 }, { text: "Sit at the edge of your chair for 1 minute", xp: 10 }, { text: "Stretch your legs under your desk", xp: 10 }, { text: "Walk slowly around your floor", xp: 15 }, { text: "Roll your shoulders backward", xp: 10 }, { text: "Stretch your forearms", xp: 10 }, { text: "Close your eyes for 10 seconds", xp: 10 }, { text: "Rotate ankles in circles", xp: 10 }, { text: "Take deep breaths before meetings", xp: 10 }, { text: "Walk around before sitting down", xp: 15 }, { text: "Check your sitting position", xp: 10 }, { text: "Stand while texting", xp: 10 }, { text: "Do side stretches", xp: 10 }, { text: "Roll your neck gently", xp: 10 }, { text: "Stretch your legs after sitting long", xp: 10 }, { text: "Move arms in circles", xp: 10 }, { text: "Take stairs at least once", xp: 15 }, { text: "Walk 5 minutes before heading home", xp: 20 }, { text: "Stretch back after long sitting", xp: 10 }, { text: "Drink one last glass of water", xp: 10 }, { text: "Take 10 mindful breaths before bed", xp: 15 }, { text: "Reflect on your activity today", xp: 10 }, { text: "Plan tomorrow‚Äôs movement goals", xp: 10 }, { text: "Avoid snacks after dinner", xp: 20 }, { text: "Sleep early tonight", xp: 20 }, { text: "Wake up and stretch immediately", xp: 15 }, { text: "Drink water first thing in the morning", xp: 10 }, { text: "Walk for 5 minutes before breakfast", xp: 15 }, { text: "Do 10 squats after waking up", xp: 20 }, { text: "Walk to work or school if possible", xp: 30 }, { text: "Use stairs instead of elevator", xp: 25 }, { text: "Do a 2-minute morning stretch", xp: 15 }, { text: "Start your day standing instead of sitting", xp: 15 }];

            // --- DATA PERSISTENCE ---
            const getStorageKey = (key) => farcasterUserFid ? `deskfit_${key}_${farcasterUserFid}` : `deskfit_${key}_local`;

            const loadState = () => {
                try {
                    const savedXP = localStorage.getItem(getStorageKey('totalXP'));
                    const savedStreak = localStorage.getItem(getStorageKey('streak'));
                    totalXP = savedXP ? parseInt(savedXP, 10) : 0;
                    streak = savedStreak ? parseInt(savedStreak, 10) : 0;
                    updateDisplays();
                } catch (e) {
                    console.error("Failed to load state from localStorage:", e);
                }
            };

            const saveState = () => {
                try {
                    localStorage.setItem(getStorageKey('totalXP'), totalXP);
                    localStorage.setItem(getStorageKey('streak'), streak);
                } catch (e) {
                    console.error("Failed to save state to localStorage:", e);
                }
            };

            // --- UI & CORE LOGIC ---
            const updateDisplays = () => {
                totalXPDisplay.textContent = totalXP;
                streakDisplay.textContent = streak;
            };

            const showTaskActionButtons = (show) => {
                completeTaskButton.style.display = show ? 'block' : 'none';
                skipTaskButton.style.display = show ? 'block' : 'none';
                getNewTaskButton.style.display = show ? 'none' : 'block';
            };

            const getNewTask = () => {
                const randomIndex = Math.floor(Math.random() * tasks.length);
                currentTask = tasks[randomIndex];
                taskDisplay.classList.remove('new-task');
                void taskDisplay.offsetWidth;
                taskTextElement.textContent = currentTask.text;
                currentTaskXPElement.textContent = `${currentTask.xp} XP`;
                taskDisplay.classList.add('new-task');
                showTaskActionButtons(true);
            };

            const completeTask = () => {
                if (!currentTask) return;
                totalXP += currentTask.xp;
                streak++;
                saveState();
                updateDisplays();
                currentTask = null;
                taskTextElement.textContent = "Great job! Get another task.";
                currentTaskXPElement.textContent = "";
                showTaskActionButtons(false);
            };

            const skipTask = () => {
                if (!currentTask) return;
                streak = 0;
                saveState();
                updateDisplays();
                currentTask = null;
                taskTextElement.textContent = "Task skipped. Try another one!";
                currentTaskXPElement.textContent = "";
                showTaskActionButtons(false);
            };

            const shareToFarcaster = async () => {
                const castText = `I just hit ${totalXP} XP with a ${streak}-day streak on DeskFit! üí™ #deskfit`;
                try {
                    await Farcaster.actions.cast({ text: castText, embeds: [{ url: window.location.href }] });
                } catch (error) {
                    console.error("Farcaster cast action failed:", error);
                    alert("Could not open Farcaster to share.");
                }
            };
            
            // --- FARCASTER INTEGRATION ---
            const initializeFarcaster = async () => {
                if (Farcaster.actions) {
                    Farcaster.actions.ready();
                }
                try {
                    const user = await Farcaster.getUser();
                    if (user && user.status === 'approved') {
                        farcasterUserFid = user.fid;
                        shareProgressButton.style.display = 'block';
                        loadState(); // Reload state with the user's specific FID
                    }
                } catch (error) {
                    console.error("Error getting Farcaster user:", error);
                }
            };

            // --- APP INITIALIZATION ---
            const initializeApp = () => {
                getNewTaskButton.addEventListener('click', getNewTask);
                completeTaskButton.addEventListener('click', completeTask);
                skipTaskButton.addEventListener('click', skipTask);
                shareProgressButton.addEventListener('click', shareToFarcaster);
                
                loadState(); // Load local/default state first
                showTaskActionButtons(false);
                
                if (typeof Farcaster !== 'undefined' && Farcaster.getUser) {
                    initializeFarcaster();
                }
            };

            initializeApp();
        });
    </script>
</body>
</html>
